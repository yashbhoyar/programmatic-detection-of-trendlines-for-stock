Programmatic detection of trendlines 

I am trying to make the following algorihtm:
1.Finding the peaks and troughs of a security for close price, high price and low price using numerical differentiation method
2.Combining peaks points of close and high for resistance line and combining trough points of close and low for support line
3.
